import{_ as l,r as o,o as i,c,e as p,a as s,b as a,d as t}from"./app-6e4b3321.js";const u={},r={href:"https://github.com/github/docs/issues/15319",target:"_blank",rel:"noopener noreferrer"},d={href:"https://github.com/rlespinasse/github-slug-action/issues/104",target:"_blank",rel:"noopener noreferrer"},k={href:"https://github.com/rlespinasse/github-slug-action",target:"_blank",rel:"noopener noreferrer"},v={href:"https://github.com/rlespinasse/github-slug-action#available-environment-variables",target:"_blank",rel:"noopener noreferrer"};function m(b,n){const e=o("ExternalLinkIcon");return i(),c("div",null,[n[7]||(n[7]=p(`<h2 id="å‰è¨€" tabindex="-1"><a class="header-anchor" href="#å‰è¨€" aria-hidden="true">#</a> å‰è¨€</h2><p>ä½¿ç”¨ GitHub Action æ—¶ï¼Œæœ‰ä¸€ç§åœºæ™¯éœ€æ±‚ä¸ºï¼Œé€šè¿‡ release è§¦å‘æ„å»ºï¼Œç„¶åæ„å»ºçš„è¿‡ç¨‹ä¸­ï¼Œè¿˜è¦ç”¨åˆ°è¿™æ¬¡åˆ›å»ºçš„ release å·ã€‚</p><p>æ­¤æ—¶æˆ‘åœ¨ learn-github ä»“åº“ä¸­è¿›è¡Œæ¼”ç»ƒã€‚æ·»åŠ äº†å¦‚ä¸‹ä¸€ä¸ª action å†…å®¹ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">name</span><span class="token punctuation">:</span> test action env

<span class="token key atrule">on</span><span class="token punctuation">:</span>
  <span class="token key atrule">release</span><span class="token punctuation">:</span>
    <span class="token key atrule">types</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>created<span class="token punctuation">]</span> <span class="token comment"># è¡¨ç¤ºåœ¨åˆ›å»ºæ–°çš„ Release æ—¶è§¦å‘</span>

<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">test_action_env</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> Test Action Env
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Checkout
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v3

      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
          env</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­¤æ—¶æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ª releaseï¼Œæˆ‘è¿™è¾¹ç‰ˆæœ¬å·ä¸ºï¼š<code>v0.5.6</code>ï¼Œç„¶ååœ¨æ—¥å¿—è¾“å‡ºä¸­æœç´¢è¿™ä¸ªå…³é”®å­—ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token constant">GITHUB_WORKFLOW_REF</span><span class="token operator">=</span>eryajf<span class="token operator">/</span>learn<span class="token operator">-</span>github<span class="token operator">/</span><span class="token punctuation">.</span>github<span class="token operator">/</span>workflows<span class="token operator">/</span>test<span class="token operator">-</span>env<span class="token punctuation">.</span>yml@refs<span class="token operator">/</span>tags<span class="token operator">/</span>v0<span class="token punctuation">.</span><span class="token number">5.6</span>
<span class="token constant">GITHUB_REF</span><span class="token operator">=</span>refs<span class="token operator">/</span>tags<span class="token operator">/</span>v0<span class="token punctuation">.</span><span class="token number">5.6</span>
<span class="token constant">GITHUB_REF_NAME</span><span class="token operator">=</span>v0<span class="token punctuation">.</span><span class="token number">5.6</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç½‘ä¸Šå¤§å¤šæ•°çš„æ–¹æ¡ˆæ˜¯å¯¹ <code>GITHUB_REF</code> è¿™ä¸ªå˜é‡ä¸‹æ‰‹ï¼Œæ¯”å¦‚ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Get Release version
  <span class="token key atrule">env</span><span class="token punctuation">:</span>
    <span class="token key atrule">ACTIONS_ALLOW_UNSECURE_COMMANDS</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
    echo &quot;::set-env name=RELEASE_VERSION::$(echo $GITHUB_REF | cut -d&#39;/&#39; -f 3)&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>ğŸ“¢æ³¨æ„ï¼š</code> éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä½¿ç”¨ set-env æ¥æ·»åŠ å˜é‡ï¼Œåˆ™éœ€è¦å£°æ˜ <code>ACTIONS_ALLOW_UNSECURE_COMMANDS: true</code>ï¼Œå¦åˆ™è¿è¡Œè¿‡ç¨‹ä¸­ä¼šæŠ¥é”™å¦‚ä¸‹ï¼š</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>The <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">set-env</span><span class="token template-punctuation string">\`</span></span> command is disabled<span class="token punctuation">.</span> Please upgrade to using Environment Files or opt into unsecure command execution by setting the <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">ACTIONS_ALLOW_UNSECURE_COMMANDS</span><span class="token template-punctuation string">\`</span></span> environment variable to <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">true</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">.</span> For more information see<span class="token operator">:</span> https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>blog<span class="token operator">/</span>changelog<span class="token operator">/</span><span class="token number">2020</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span>github<span class="token operator">-</span>actions<span class="token operator">-</span>deprecating<span class="token operator">-</span>set<span class="token operator">-</span>env<span class="token operator">-</span>and<span class="token operator">-</span>add<span class="token operator">-</span>path<span class="token operator">-</span>commands<span class="token operator">/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¿™è‡ªç„¶æ²¡ä»€ä¹ˆæ¯›ç—…ï¼Œä½†ç€å®ç”¨èµ·æ¥ä¸å¤Ÿæ–¹ä¾¿ï¼Œä¸å¤Ÿä¼˜é›…ã€‚</p><p>ä¹Ÿè®¸ä½ çœ‹åˆ°äº†ï¼Œä¸Šè¾¹æ—¥å¿—è¾“å‡ºä¸­è¿˜æœ‰ä¸€ä¸ª <code>GITHUB_REF_NAME</code>ï¼Œæ­£å¥½å°±æ˜¯æˆ‘å’Œä½ æƒ³è¦çš„å€¼ï¼Œä½†æ˜¯æˆ‘æƒ³å‘Šè¯‰ä½ çš„æ˜¯ï¼Œçš„ç¡®å®˜æ–¹æ–°ç»™å‡ºäº†è¿™ä¸ªå˜é‡ï¼Œä½†å¯æ°”çš„æ˜¯ï¼Œè¿™ä¸ªå˜é‡å¹¶æ²¡æœ‰åœ¨å…¨å±€æš´æ¼ï¼Œå› æ­¤è™½ç„¶èƒ½åœ¨è¿™ä¸ª <code>env</code> è¾“å‡ºå½“ä¸­çœ‹åˆ°è¿™ä¸ªå˜é‡ï¼Œä½†å®é™…å´å¹¶ä¸èƒ½ç”¨ã€‚</p><p>å…³äºæ­¤é—®é¢˜ï¼Œå¯è§è¿™ä¸¤ä¸ªè®¨è®ºï¼š</p>`,13)),s("ul",null,[s("li",null,[s("a",r,[n[0]||(n[0]=a("https://github.com/github/docs/issues/15319")),t(e)])]),s("li",null,[s("a",d,[n[1]||(n[1]=a("https://github.com/rlespinasse/github-slug-action/issues/104")),t(e)])])]),n[8]||(n[8]=p(`<h2 id="éªŒè¯" tabindex="-1"><a class="header-anchor" href="#éªŒè¯" aria-hidden="true">#</a> éªŒè¯</h2><p>ä¸ºäº†éªŒè¯å¦‚ä¸Šè¡¨è¿°çš„å†…å®¹ï¼Œæˆ‘åˆ›å»ºä¸€ä¸ªæµ‹è¯•è„šæœ¬å¦‚ä¸‹ï¼š</p><p>::: v-pre</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">name</span><span class="token punctuation">:</span> test action env

<span class="token key atrule">on</span><span class="token punctuation">:</span>
  <span class="token key atrule">release</span><span class="token punctuation">:</span>
    <span class="token key atrule">types</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>created<span class="token punctuation">]</span> <span class="token comment"># è¡¨ç¤ºåœ¨åˆ›å»ºæ–°çš„ Release æ—¶è§¦å‘</span>

<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">test_action_env</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> Test Action Env
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Checkout
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v3

      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
          env</span>

      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Get Release version
        <span class="token key atrule">id</span><span class="token punctuation">:</span> vars
        <span class="token key atrule">env</span><span class="token punctuation">:</span>
          <span class="token key atrule">ACTIONS_ALLOW_UNSECURE_COMMANDS</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
          echo &quot;::set-env name=RELEASE_VERSION_ONE::$(echo $GITHUB_REF | cut -d&#39;/&#39; -f 3)&quot;</span>

      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Get Release version
        <span class="token key atrule">run</span><span class="token punctuation">:</span> echo &quot;RELEASE_VERSION_TWO=$<span class="token punctuation">{</span>GITHUB_REF<span class="token comment">#refs/*/}&quot; &gt;&gt; $GITHUB_ENV</span>

      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Show Release Num
        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
          echo &quot;é€šè¿‡GitHub-Actionè·å–ç‰ˆæœ¬å·ï¼š \${{ env.GITHUB_REF_NAME }}&quot;
          echo &quot;é€šè¿‡è‡ªå®šä¹‰è„šæœ¬è·å–ç‰ˆæœ¬å·ç¬¬ä¸€ç§ï¼š \${{ env.RELEASE_VERSION_ONE }}&quot;
          echo &quot;é€šè¿‡è‡ªå®šä¹‰è„šæœ¬è·å–ç‰ˆæœ¬å·ç¬¬äºŒç§ï¼š \${{ env.RELEASE_VERSION_TWO }}&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>:::</p><p>è¿è¡Œåå¾—åˆ°ç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/eryajf/tu/img/image_20230228_151615.jpg" alt="image_20230228_151615"></p><p>::: v-pre å¯è§è™½ç„¶åœ¨å…¨å±€ç¯å¢ƒå˜é‡ä¸­èƒ½çœ‹åˆ° <code>GITHUB_REF_NAME=v0.5.13</code>ï¼Œä½†å®é™…ä¸Šåœ¨åç»­çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œä½ å¹¶ä¸èƒ½é€šè¿‡ <code>\${{ env.GITHUB_REF_NAME }}</code> æ¥å¼•ç”¨è¿™ä¸ªå˜é‡ã€‚ :::</p><h2 id="è§£å†³" tabindex="-1"><a class="header-anchor" href="#è§£å†³" aria-hidden="true">#</a> è§£å†³</h2><p>è™½ç„¶ä¸Šè¾¹çš„è„šæœ¬æä¾›äº†ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯éƒ½ä¸ç®—å¤Ÿä¼˜é›…ï¼Œç½‘ä¸Šä¹Ÿæœ‰é’ˆå¯¹è¿™ä¸€é—®é¢˜å¤„ç†çš„è§£å†³æ–¹æ¡ˆï¼Œå…¶ä¸­ä»¥ä¸“é—¨é’ˆå¯¹ GitHub Action ä¸­å˜é‡é—®é¢˜è§£å†³çš„é¡¹ç›® github-slug-action ä¸ºç”šï¼Œè¿™ä¹Ÿæ˜¯æœ¬æ–‡çš„ä¸»è§’ã€‚</p>`,10)),s("ul",null,[s("li",null,[n[3]||(n[3]=a("é¡¹ç›®ï¼š")),s("a",k,[n[2]||(n[2]=a("github-slug-action")),t(e)])])]),n[9]||(n[9]=p(`<p>è¿™ä¸ª Action æä¾›äº†ä¸€ç³»åˆ— GitHub Action è¿è¡Œè¿‡ç¨‹ä¸­çš„å˜é‡æš´æ¼ç­‰åŠŸèƒ½ã€‚</p><p>æ­¤æ—¶æˆ‘ä»¬æŠŠ action çš„é…ç½®æ–‡ä»¶æ”¹æˆä¸‹è¾¹è¿™æ ·ï¼š</p><p>::: v-pre</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">name</span><span class="token punctuation">:</span> test action env

<span class="token key atrule">on</span><span class="token punctuation">:</span>
  <span class="token key atrule">release</span><span class="token punctuation">:</span>
    <span class="token key atrule">types</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>created<span class="token punctuation">]</span> <span class="token comment"># è¡¨ç¤ºåœ¨åˆ›å»ºæ–°çš„ Release æ—¶è§¦å‘</span>

<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">test_action_env</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> Test Action Env
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Checkout
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v3

      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Inject slug/short variables
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> rlespinasse/github<span class="token punctuation">-</span>slug<span class="token punctuation">-</span>action@v4

      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
          env</span>

      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Show Release Num
        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
          echo &quot;é€šè¿‡GitHub-Actionè·å–ç‰ˆæœ¬å·ï¼š \${{ env.GITHUB_REF_NAME }}&quot;
          echo &quot;é€šè¿‡github-slug-actionè·å–ç‰ˆæœ¬å·ï¼š \${{ env.GITHUB_REF_NAME_SLUG }}&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>:::</p><p>::: v-pre å½“æˆ‘ä»¬æŠŠ github-slug-action åº”ç”¨åœ¨æµæ°´çº¿ä¸­ä¹‹åï¼Œå®ƒé¦–å…ˆä¼šæŠŠåŸæ¥å®˜æ–¹é—æ¼çš„å˜é‡ <code>\${{ env.GITHUB_REF_NAME }}</code> ç»™å¡«å……å¥½ï¼Œå…¶æ¬¡ä¹Ÿå¯ä»¥é€šè¿‡ä½¿ç”¨ <code>\${{ env.GITHUB_REF_NAME_SLUG }}</code> æ¥è·å–åˆ°å¯¹åº”çš„ç‰ˆæœ¬å·ã€‚ :::</p><p>é™¤å»è¿™ä¸ªå˜é‡ä¹‹å¤–ï¼Œgithub-slug-action è¿˜æä¾›äº†å…¶ä»–ä¸€äº›å˜é‡ï¼Œå¹¶ä¸”åšåˆ°äº†é…ç½®ç®€å•(å¦‚ä½ æ‰€è§ï¼Œåœ¨æµæ°´çº¿ä¸­å¼•ç”¨å³å¯)ï¼Œä¼˜é›…æ˜“ç”¨ï¼Œå› æ­¤æ˜¯ä¸€ä¸ªæ€§ä»·æ¯”éå¸¸é«˜çš„ï¼Œå€¼å¾—åœ¨æµæ°´çº¿ä¸­åº”ç”¨çš„ actionã€‚</p>`,7)),s("ul",null,[s("li",null,[n[5]||(n[5]=a("æ›´å¤šå¯ç”¨å˜é‡ï¼Œå¯å‚è€ƒ")),s("a",v,[n[4]||(n[4]=a("å®˜æ–¹æ–‡æ¡£çš„è¯´æ˜")),t(e)]),n[6]||(n[6]=a("ã€‚"))])])])}const h=l(u,[["render",m],["__file","10-Use-github-slug-action-to-leak-key-variables-in-the-Github-Action-context.html.vue"]]);export{h as default};
